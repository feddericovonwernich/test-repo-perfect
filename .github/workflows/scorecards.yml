name: Scorecards Quality Check

on:
  schedule:
    - cron: '0 0 * * *'  # Daily at midnight UTC
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  scorecard:
    runs-on: ubuntu-latest
    name: Run Scorecards

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Scorecards Action
        uses: feddericovonwernich/scorecards/action@main
        id: scorecards
        with:
          github-token: ${{ secrets.SCORECARDS_CATALOG_TOKEN }}
          scorecards-repo: 'feddericovonwernich/scorecards'
          scorecards-branch: 'catalog'

      - name: Display Results
        run: |
          echo "## Scorecards Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Score:** ${{ steps.scorecards.outputs.score }}/100" >> $GITHUB_STEP_SUMMARY
          echo "**Rank:** ${{ steps.scorecards.outputs.rank }}" >> $GITHUB_STEP_SUMMARY
          echo "**Passed Checks:** ${{ steps.scorecards.outputs.passed-checks }}/${{ steps.scorecards.outputs.total-checks }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Details" >> $GITHUB_STEP_SUMMARY
          if [ -f "${{ steps.scorecards.outputs.results-file }}" ]; then
            cat "${{ steps.scorecards.outputs.results-file }}"
          fi

      - name: Upload Results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: scorecard-results
          path: ${{ steps.scorecards.outputs.results-file }}
